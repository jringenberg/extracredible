# Extracredible - Solidity Development Rules

You are an expert Solidity developer working on Extracredible, a belief-staking protocol on Base (Optimism L2).

## Project Context

Extracredible lets users stake $2 USDC on belief statements. Stakes are binary commitments (one stake per user per belief), not wealth signals. The protocol uses EAS (Ethereum Attestation Service) for immutable belief attestations and a separate BeliefStake contract for stake management.

## Architecture

- **BeliefStake.sol**: Main escrow contract. Holds stakes, tracks totals, emits events for The Graph.
- **IYieldStrategy.sol**: Interface for swappable yield strategies. Abstracts where idle USDC goes.
- **NullYieldStrategy.sol**: Initial implementation that holds USDC with no yield (the "backdoor").
- **AaveYieldStrategy.sol** (future): Deposits to Aave V3, yield goes to protocol treasury.

## Technical Stack

- Solidity ^0.8.20
- Foundry for development and testing
- OpenZeppelin Contracts v5.x
- Base mainnet (Chain ID: 8453)
- USDC as stake token (6 decimals)

## Coding Standards

1. Use custom errors over require strings (gas efficient)
2. Use SafeERC20 for all token transfers
3. Include ReentrancyGuard on functions that transfer tokens
4. Emit events for all state changes (subgraph indexes these)
5. Use NatSpec comments for all public functions
6. Prefer immutable over constant where constructor sets value
7. Use explicit visibility modifiers

## Security Patterns

- Check-Effects-Interactions pattern
- Pull over push for payments
- No delegatecall to untrusted contracts
- Validate all external inputs
- Use Ownable for admin functions, consider 2-step transfer

## Contract Addresses (Base Mainnet)

- EAS Registry: 0x4200000000000000000000000000000000000021
- USDC: 0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913
- BeliefStake: 0xaff45F0Fc8AF91B9D3A317d550307Efe0FFb7956
- NullYieldStrategy: 0xdAE47395B1BbE2Ab6b94D9FcFa1B1ebd88c14395
- Treasury (Safe): 0x8386571713221cBD4D61CbB0a4794AbCF4647055
- Schema UID: 0x21f7fcf4af0c022d3e7316b6a5b9a04dcaedac59eaea803251e653abd1db9fd6

## Testing

- Write Foundry tests for all contracts
- Test edge cases: zero amounts, double stakes, unauthorized access
- Use forge coverage to ensure >90% coverage
- Test strategy migrations atomically

## Key Constraints

- Fixed $2 stake amount (STAKE_AMOUNT = 2_000_000)
- One stake per user per belief
- All yield to protocol treasury, users get principal only
- Must support strategy migration without user action
